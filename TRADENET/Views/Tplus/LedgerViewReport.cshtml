@model IEnumerable<TRADENET.Models.LedgerModel>

@{
    ViewBag.Title = "Ledger";
    Layout = null;
    decimal CrTotal = 0;
    decimal DrTotal = 0;
    decimal GroupBalance = 0;
    decimal GrandCrTotal = 0;
    decimal GrandDrTotal = 0;
    decimal GrandBalance = 0;
    string strCode = "";
    string strCodeName = "";
    string Pnao = "";


}
@Styles.Render("~/Content/css")
@Styles.Render("~/AdminLTE/css")
@Styles.Render("~/DataTables/css")
@Styles.Render("~/Ionicons/css")
@Styles.Render("~/font-awesome/css")
<link href="../AdminLTE/multiselct/dist/css/bootstrap-multiselect.css" rel="stylesheet" />
@if (Model == null || Model.Count() == 0)
{
    <div id="pnlPopup" class="alert alert-info">
        <strong>Info!</strong> NO RECORDS FOUND
    </div>
    return;
}

<style>
    tr:nth-child(even) {
        background-color: lightsteelblue;
    }

    .Voucher {
        width: 50px;
    }

    .ES {
        width: 30px;
    }

    .dateCol {
        width: 90px;
    }

    .particular {
        width: 700px;
    }

    .amount {
        width: 100px;
        text-align: right;
        vertical-align: bottom;
    }

    .rightalign {
        text-align: right;
        vertical-align: bottom;
    }

    .centeralign {
        text-align: center;
        vertical-align: bottom;
    }


    .settlement {
        width: 150px;
        text-align: center;
    }
</style>

<script type="text/javascript">
    $(function () {
        $("#btnSubmit").click(function () {

            $("input[name='GridHtml']").val($("#GridNew").html());
            $("input[name='reporttittle']").val($("#divReportPanelHeader").text());
            $("input[name='reportname']").val($("#divReportPanelHeader").text());
        });
    });
</script>

<div class="panel-body" style="font-family:Verdana; font-size:11px">
    <div id="divSaveReport" style="float:left;display:inline-block">

        Export :: <input id="export" type="button" onclick="exportToExcel('LedgerReport', 'tblLedgerpdf','@System.Configuration.ConfigurationManager.AppSettings["OrganizationName"].ToString()', document.getElementById('divReportPanelHeader').textContent)" class="excel-button" value="To Excel" />

    </div>
    <div id="divSaveReport1" style="float:left;">
        @using (Html.BeginForm("Export", "Tplus", FormMethod.Post))
        {
            <input type="hidden" name="GridHtml" /><input type="hidden" name="reporttittle" /><input type="hidden" name="reportname" /><input type="submit" id="btnSubmit" value="To PDF" style="margin-left:10px" />
        }
    </div>

    @Html.ActionLink("Report", "LedgerReportView")

    @*<a id="ReportClick" @Html.Action("LedgerReportView", new { model = Model })>Report</a>*@

    <table id="tblLedger" class="table table-responsive" style="font-size:11px;">
        <thead>
            <tr class="GroupHeader">
                <td colspan="12"></td>


            </tr>
        </thead>
        <tbody>
            @foreach (var d in Model)
            {
                strCodeName = d.ClientName;
                Pnao = d.Panno;
                if (ViewBag.clientcondition == "view")
                {

                    @*<tr class="">
                            <td colspan="12" style="background-color:white;" class="centeralign"><strong>COMPLIANCE OFFICER :</strong> <strong>@ViewBag.strCompOff</strong></td>
                        </tr>*@
                    <tr class="" style="line-height: 1;">
                        <td colspan="12" style="background-color:white;line-height: 0.4;font-size:10px" class="leftalign"><strong>@d.ClientName</strong></td>
                    </tr>
                    <tr class="">
                        <td colspan="12" style="background-color:white;line-height: 0.4;font-size:10px" class="leftalign"><strong>@d.Add1</strong></td>
                    </tr>
                    <tr class="">
                        <td colspan="12" style="background-color:white;line-height: 0.4;font-size:10px" class="leftalign"><strong>@d.Add2</strong></td>
                    </tr>
                    <tr class="">
                        <td colspan="12" style="background-color:white;line-height: 0.4;font-size:10px" class="leftalign"><strong>@d.Add3</strong></td>
                    </tr>
                    <tr class="">
                        <td colspan="12" style="background-color:white;line-height: 0.4;font-size:10px" class="leftalign"><strong>@d.Add4</strong></td>
                    </tr>
                    @*if (ViewBag.strchkConfirmation == "1")
                        {
                            <tr class="">
                                <td colspan="12" class="leftalign">
                                    <strong>
                                        "Sir/Madam,<br />
                                        Please find herewith statement of Accounts Ledger from @ViewBag.FromDate to @ViewBag.ToDate  . Discrepancies,
                                        if any, need to be intimated to us within 30 days from the date of receipt of this document. Further,
                                        the Running A/c Authorisation would continue until it is revoked by you by making a written request"
                                    </strong>
                                </td>
                            </tr>
                        }*@
                }
                break;
            }
            <tr style="font-weight:bold;" class="GroupHeader">
                <td style="font-weight:bold;width:5%;" class="dateCol">Date</td>
                <td class="ES" style="width:5%">E/S</td>
                <td class="Voucher" style="width:10%">Voucher</td>
                <td class="particular" style="width:30%">Particular</td>
                <td class="amount" style="width:15%">Debit</td>
                <td class="amount" style="width:15%">Credit</td>
                <td class="amount" style="width:15%">Balance</td>
                <td class="ES"></td>
                <th class="Voucher" style="display:none;">settlement</th>
                <th class="ES" style="display:none;">ExSeg</th>
                <th class="dateCol" style="display:none;">Date</th>
                <th class="dateCol" style="display:none;">ld_clientcd</th>

            </tr>
            @foreach (var d in Model)
            {


                if (strCode.Trim() != d.ClientCd.ToString().Trim())
                {
                    if (strCode.Trim() != "")
                    {

                        <tr>
                            <td class="GroupHeader" colspan="4"><strong>Sub Total</strong></td>
                            @if (@DrTotal > 0)
                            {
                                <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", DrTotal)</strong></td>
                            }
                            else
                            {
                                <td class="GroupHeader"></td>
                            }

                            @if (@CrTotal > 0)
                            {
                                <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", CrTotal)</strong></td>
                            }
                            else
                            {
                                <td class="GroupHeader"></td>
                            }
                            @if (GroupBalance <= 0)
                            {
                                GroupBalance = Math.Abs(GroupBalance);
                                <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong></td>
                                <td class="GroupHeader"><strong>Cr</strong></td>
                            }
                            else
                            {
                                <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong></td>
                                <td class="GroupHeader"><strong>Dr</strong></td>
                            }
                        </tr>
                    }



                    <tr>
                        <td class="GroupHeader" colspan="11"><strong>[  @d.ClientName ] </strong></td>
                    </tr>


                    strCode = d.ClientCd.ToString().Trim();
                    CrTotal = 0;
                    DrTotal = 0;
                    GroupBalance = 0;
                }

                {

                    if (d.Credit > 0)
                    {
                        CrTotal += d.Credit;
                        GrandCrTotal += d.Credit;
                        GroupBalance -= d.Credit;
                        GrandBalance -= d.Credit;
                    }
                    else
                    {
                        DrTotal += d.Debit;
                        GrandDrTotal += d.Debit;
                        GroupBalance += d.Debit;
                        GrandBalance += d.Debit;
                    }
                }

                <tr>
                    <td>@d.Date</td>
                    <td>@d.ExSeg</td>
                    <td>@d.Voucher</td>
                    @if (d.DocType == "B")
                    {

                        <td><a href="#" onmouseover="this.style.color='#4682B4'" onmouseout="this.style.color='black'" style="color: black; text-decoration: underline;">@d.Particular </a></td>
                    }
                    else
                    {
                        <td>@d.Particular </td>
                    }
                    @if (@d.Debit > 0)
                    {
                        <td class="rightalign">@String.Format("{0:0.00}", d.Debit)</td>
                        <td></td>
                    }
                    else if (@d.Credit > 0)
                    {
                        <td></td>
                        <td class="rightalign">@String.Format("{0:0.00}", d.Credit) &nbsp; @d.unclear</td>
                    }
                    else
                    {
                        <td class="rightalign">@String.Format("{0:0.00}", d.Debit)</td>
                        <td class="rightalign">0.00</td>
                    }
                    <td class="rightalign">@String.Format("{0:0.00}", d.Balance)</td>
                    <td>@d.Flag</td>
                    <td class="rightalign" style="display:none;">@d.Common</td>

                    <td class="rightalign" style="display:none;">@d.ExSeg</td>

                    <td class="rightalign" style="display:none;">@d.CommonDt</td>
                    <td class="rightalign" style="display:none;">@d.ld_clientcd</td>
                </tr>
            }

            <tr>
                <td class="GroupHeader" colspan="4"><strong>Sub Total</strong></td>
                @if (@DrTotal > 0)
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", DrTotal)</strong></td>
                }
                else
                {
                    <td class="GroupHeader"></td>
                }

                @if (@CrTotal > 0)
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", CrTotal)</strong></td>
                }
                else
                {
                    <td class="GroupHeader"></td>
                }
                @if (GroupBalance <= 0)
                {
                    GroupBalance = Math.Abs(GroupBalance);
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong></td>
                    <td class="GroupHeader"><strong>Cr</strong></td>
                }
                else
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong></td>
                    <td class="GroupHeader"><strong>Dr</strong></td>
                }
            </tr>

            <tr>
                <td class="GroupHeader" colspan="4"><strong>Grand Total</strong></td>
                @if (@GrandDrTotal > 0)
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandDrTotal)</strong></td>
                }
                else
                {
                    <td class="GroupHeader"></td>
                }

                @if (@GrandCrTotal > 0)
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandCrTotal)</strong></td>
                }
                else
                {
                    <td class="GroupHeader"></td>
                }
                @if (GrandBalance <= 0)
                {
                    GrandBalance = Math.Abs(GrandBalance);
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandBalance)</strong></td>
                    <td class="GroupHeader"><strong>Cr</strong></td>
                }
                else
                {
                    <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandBalance)</strong></td>
                    <td class="GroupHeader"><strong>Dr</strong></td>
                }
            </tr>

        </tbody>

    </table>
    @*<table class="table table-responsive">
            <tbody>


                @if (ViewBag.clientcondition == "view")
                {
                    if (ViewBag.strchkConfirmation == "1")
                    {

                        <tr style="background-color:white; font-weight:bold;" align="right"><td> Yours faithfully,</td></tr>
                        <tr style="background-color:white; font-weight:bold;" align="right"><td>For @System.Configuration.ConfigurationManager.AppSettings["OrganizationName"].ToString() </td></tr>
                        <tr style="background-color:white; font-weight:bold;"><td> I / We hereby confirm that I/ we received all the contract notes / bills as reflected in my / our ledger and all the entries of the bills, cheques, delivery of shares and JVs, if any, have been truly reflected. I / we also undertake to keep you indemnified against all the third party claims, if any, arising out of this account. </td></tr>
                        <tr style="background-color:white; font-weight:bold;"> <td><br /> For @strCodeName <br /></td></tr>
                        <tr style="background-color:white; font-weight:bold;">
                            <td>
                                (Authorised Signatory)<br />
                                PAN No : @Pnao <p style="margin-left: 960px;"> </p>  <p align="right"> PAN No:@Session["PanNo"] </p>
                                <br />  This is a Computer Generated Statement, So doesnt require Signature<br />
                                Account Of :@strCodeName
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>*@




    @{
        CrTotal = 0;
        DrTotal = 0;
        GroupBalance = 0;
        GrandCrTotal = 0;
        GrandDrTotal = 0;
        GrandBalance = 0;
        strCode = "";
        strCodeName = "";
        Pnao = "";


    }
    <div id="GridNew" hidden="hidden">
        <style>
            table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
            }

            td, th {
                border: 1px #dddddd;
                padding: 4px;
            }

            .rightalign {
                text-align: right;
            }

            .leftalign {
                text-align: left;
            }

            .centeralign {
                text-align: center;
            }
        </style>
        <table id="tblLedgerpdf" class="table table-responsive" style="font-size:10px; font-family: arial, sans-serif;  border-collapse: collapse;  width: 100%;">
            <thead>
                <tr class="GroupHeader">
                    <td colspan="7"></td>

                </tr>
            </thead>
            <tbody>
                @foreach (var d in Model)
                {
                    strCodeName = d.ClientName;
                    Pnao = d.Panno;
                    if (ViewBag.clientcondition == "view")
                    {

                        <tr>
                            <td colspan="7" style="background-color:white; font-size:10px;" class="centeralign">
                                <div>
                                    <div><strong>COMPLIANCE OFFICER : @ViewBag.strCompOff</strong></div>
                                    <div><strong>@d.ClientName</strong></div>
                                    <div><strong>@d.Add1</strong></div>
                                    <div><strong>@d.Add2</strong></div>


                                    <div><strong>@d.Add3</strong></div>
                                    <div><strong>@d.Add4</strong></div>
                                </div>
                            </td>
                        </tr>


                        @*if (ViewBag.strchkConfirmation == "1")
                            {
                                <tr class="">
                                    <td colspan="7" class="leftalign">
                                        <strong>
                                            "Sir/Madam,<br />
                                            Please find herewith statement of Accounts Ledger from @ViewBag.FromDate to @ViewBag.ToDate  . Discrepancies,
                                            if any, need to be intimated to us within 30 days from the date of receipt of this document. Further,
                                            the Running A/c Authorisation would continue until it is revoked by you by making a written request"
                                        </strong>
                                    </td>
                                </tr>
                            }*@
                    }
                    break;
                }
                <tr style="font-weight:bold;" class="GroupHeader">
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:10%;" class="dateCol">Date</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:4%;" class="ES">E/S</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:7%;" class="Voucher">Voucher</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:24%;" class="particular">Particular</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:12%;" class="amount">Debit</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:12%;" class="amount">Credit</td>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;width:14%;" class="amount">Balance</td>
                </tr>
                @foreach (var d in Model)
                {


                    if (strCode.Trim() != d.ClientCd.ToString().Trim())
                    {
                        if (strCode.Trim() != "")
                        {

                            <tr>
                                <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader" colspan="4"><strong>Sub Total</strong></td>
                                @if (@DrTotal > 0)
                                {
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", DrTotal)</strong></td>
                                }
                                else
                                {
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                                }
                                @if (@CrTotal > 0)
                                {
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", CrTotal)</strong></td>
                                }
                                else
                                {
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                                }
                                @if (GroupBalance <= 0)
                                {
                                    GroupBalance = Math.Abs(GroupBalance);
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong><strong>Cr</strong></td>

                                }
                                else
                                {
                                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong><strong>Dr</strong></td>

                                }
                            </tr>
                        }



                        <tr>
                            <td class="GroupHeader" colspan="7"><strong>[ @d.ClientName ] </strong></td>
                        </tr>


                        strCode = d.ClientCd.ToString().Trim();
                        CrTotal = 0;
                        DrTotal = 0;
                        GroupBalance = 0;
                    }

                    {

                        if (d.Credit > 0)
                        {
                            CrTotal += d.Credit;
                            GrandCrTotal += d.Credit;
                            GroupBalance -= d.Credit;
                            GrandBalance -= d.Credit;
                        }
                        else
                        {
                            DrTotal += d.Debit;
                            GrandDrTotal += d.Debit;
                            GroupBalance += d.Debit;
                            GrandBalance += d.Debit;
                        }
                    }

                    <tr>
                        <td>@d.Date</td>
                        <td>@d.ExSeg</td>
                        <td>@d.Voucher</td>
                        @if (d.DocType == "B")
                        {
                            <td>@d.Particular </td>
                        }
                        else
                        {
                            <td>@d.Particular </td>
                        }
                        @if (@d.Debit > 0)
                        {
                            <td class="rightalign">@String.Format("{0:0.00}", d.Debit)</td>
                            <td></td>
                        }
                        else if (@d.Credit > 0)
                        {
                            <td></td>
                            <td class="rightalign">@String.Format("{0:0.00}", d.Credit)</td>
                        }

                        <td class="rightalign">@String.Format("{0:0.00}", d.Balance) @d.Flag</td>
                    </tr>
                }
                <tr>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader" colspan="4"><strong>Sub Total</strong></td>
                    @if (@DrTotal > 0)
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", DrTotal)</strong></td>
                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                    }
                    @if (@CrTotal > 0)
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", CrTotal)</strong></td>
                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                    }

                    @if (GroupBalance <= 0)
                    {
                        GroupBalance = Math.Abs(GroupBalance);
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong><strong>Cr</strong></td>

                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GroupBalance)</strong><strong>Dr</strong></td>

                    }
                </tr>
                <tr>
                    <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader" colspan="4"><strong>Grand Total</strong></td>
                    @if (@GrandDrTotal > 0)
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandDrTotal)</strong></td>
                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                    }
                    @if (@GrandCrTotal > 0)
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandCrTotal)</strong></td>
                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="GroupHeader"></td>
                    }

                    @if (GrandBalance <= 0)
                    {
                        GrandBalance = Math.Abs(GrandBalance);
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandBalance)</strong> <strong>Cr</strong></td>

                    }
                    else
                    {
                        <td style="font-weight:bold; background-color:#4682b4; color:white;" class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GrandBalance)</strong><strong>Dr</strong></td>

                    }
                </tr>
                @if (ViewBag.clientcondition == "view")
                {
                    @*if (ViewBag.strchkConfirmation == "1")
                        {

                                <tr style="background-color:white; font-weight:bold;" align="right"><td> Yours faithfully,</td></tr>
                                <tr style="background-color:white; font-weight:bold;" align="right">
                                    <td>
                                        For @System.Configuration.ConfigurationManager.AppSettings["OrganizationName"].ToString()
                                    </td>
                                </tr>
                                        <tr style="background-color:white; font-weight:bold;"><td> I / We hereby confirm that I/ we received all the contract notes / bills as reflected in my / our ledger and all the entries of the bills, cheques, delivery of shares and JVs, if any, have been truly reflected. I / we also undertake to keep you indemnified against all the third party claims, if any, arising out of this account. </td></tr>
                                        <tr style="background-color:white; font-weight:bold;"> <td><br /> For @strCodeName <br /></td></tr>
                                        <tr style="background-color:white; font-weight:bold;">
                                            <td>
                                                (Authorised Signatory)<br />
                                                PAN No : @Pnao <p style="margin-left: 960px;"> </p>  <p align="right"> PAN No:@Session["PanNo"] </p>
                                                <br />  This is a Computer Generated Statement, So doesnt require Signature<br />
                                                Account Of :@strCodeName
                                            </td>
                                        </tr>
                            }*@
                }
            </tbody>
        </table>
    </div>







</div>

<script>
    $(document).on('click', "#tblLedger td", function (event) {
        event.stopImmediatePropagation();
        event.preventDefault();

        var colindex = $(this).index();
        if (colindex == 3) {

            var code = "";
            //var valNew = $('#txtSearchbyName').val();

            //if (valNew.trim() != "") {
            //    valNew = $('#txtSearchbyName').val().split("~");
            //    code = valNew[1]
            //}

            var code = $(this).closest('tr').children('td:eq(11)').text();

            var stlmnt = $(this).closest('tr').children('td:eq(8)').text();

            var name = '';


            var date = $(this).closest('tr').children('td:eq(0)').text();

            var strExSeg = $(this).closest('tr').children('td:eq(1)').text();
            var strExSegCond = strExSeg.charAt(strExSeg.length - 1);
            var strexchange = strExSeg.charAt(strExSeg.length - 2);
            var date1 = $(this).closest('tr').children('td:eq(10)').text();

            var Voucher = $(this).closest('tr').children('td:eq(2)').text();
            var bill = Voucher.substring(0, 1);
            var Particular = $(this).closest('tr').children('td:eq(3)').text();

            var head = name + ' [' + code + ']';

            //  if(bill=='B')
            if (Particular.indexOf('Bill') != -1) {

                 if (strExSeg == 'BX' || strExSeg == 'NX')
                {
                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("GetFOBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'code': code, 'strOrderBy': 'Client', 'strDate': date1, 'strexchange': stlmnt, 'strexchange': strexchange, 'strSegment': strExSegCond },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "width=800, height=400, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }
                else if (strExSegCond == 'C') {
                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("GetBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'code': code, 'strOrderBy': 'Client', 'FromDate': date, 'strstlmnt': stlmnt, 'strSelect': 'CL' },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "toolbar=yes,resizable,width=700, height=400, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }

                else if (strExSegCond == 'M') {

                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("GetMfBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'code': code, 'strOrderBy': 'Client', 'strDate': date1, 'strexchange': stlmnt, 'strexchange': strexchange, 'strSegment': strExSegCond },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "resizable,width=700, height=400, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }
                else if (strExSegCond == 'F') {
                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("GetFOBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'code': code, 'strOrderBy': 'Client', 'strDate': date1, 'strexchange': stlmnt, 'strexchange': strexchange, 'strSegment': strExSegCond },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "width=650, height=450, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },


                        error: function (response) {
                            alert(response.responseText);
                        }
                    });

                }
                else if (strExSegCond == 'X') {
                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("ComBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'strDpid': strExSeg, 'Code': code, 'FromDt': date1 },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "resizable,width=700, height=400, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }
                else {
                    $.ajax({
                        type: "GET",

                        url: '@Url.Action("GetFOBillPrint", "Tplus")',
                        dataType: "html",
                        data: { 'code': code, 'strOrderBy': 'Client', 'strDate': date1, 'strexchange': stlmnt, 'strexchange': strexchange, 'strSegment': strExSegCond },
                        contentType: "application/html; charset=utf-8",
                        beforeSend: function () {
                            $('#divModalProgress').modal('show');
                        },
                        success: function (response) {
                            var w = window.open("", "popupWindow", "width=800, height=400, scrollbars=yes");
                            var $w = $(w.document.body);
                            $w.html(response);
                        },
                        complete: function () {
                            $('#divModalProgress').modal('hide');
                        },
                        failure: function (response) {
                            alert(response.responseText);
                        },
                        error: function (response) {
                            alert(response.responseText);
                        }
                    });
                }

            }

        }

    });

</script>
<script src="~/Scripts/Export.js"></script>