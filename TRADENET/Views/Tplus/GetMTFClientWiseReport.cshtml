@model System.Data.DataTable
@using System.Data;

@{
    Layout = null;

}

@if (Model == null || Model.Rows.Count == 0)
{
    <div id="pnlPopup" class="alert alert-info">
        <strong>Info!</strong> NO RECORDS FOUND
    </div>
    return;
}
@{
    var Report = ViewBag.Report;
    var GroupBy = ViewBag.GroupBy;
}
<style>
    .rightalign {
        text-align: right;
    }

    .leftalign {
        text-align: left;
    }

    tr td {
        padding: 4px !important;
        margin: 4px !important;
    }

    .GroupHeader {
        background: #4682B4;
        color: white;
    }

    .table {
        font-family: Verdana !important;
        font-size: 10px !important;
    }

    tr:nth-child(even) {
        background-color: lightsteelblue;
    }
</style>


@{
    decimal Qty = 0;
    decimal ActualCost = 0;
    decimal MarketValue = 0;
    decimal MTM = 0;
    List<DataTable> result = null;
   

}

<script type="text/javascript">
    $(function () {
        $("#btnSubmit").click(function () {

            $("input[name='GridHtml']").val($("#GridNew").html());
            $("input[name='reporttittle']").val($("#divReportPanelHeader").text());
            $("input[name='reportname']").val($("#divReportPanelHeader").text());

        });
    });
</script>
<div>
    <div id="divSaveReport" style="float:left;display:inline-block">
        Export:: <input id="export" type="button" onclick="exportToExcel('MTFClientPosition', 'tblClient','@System.Configuration.ConfigurationManager.AppSettings["OrganizationName"].ToString().Trim()',document.getElementById('divReportPanelHeader').textContent)" class="excel-button" value="To Excel" />
        @*<input type="button" id="btnExport" value="To PDF" onclick="Export('TradeListing', 'tblClient')" />*@
    </div>


    <div id="divSaveReport1" style="float:left;">
        @using (Html.BeginForm("Export", "Tplus", FormMethod.Post))
        {
            <input type="hidden" name="GridHtml" /><input type="hidden" name="reporttittle" /><input type="hidden" name="reportname" /><input type="submit" id="btnSubmit" value="To PDF" style="margin-left:10px" />
        }
    </div>
  

        <table id="tblClient" class="table">
            <tr class="GroupHeader">
                <td class="leftalign">Code&nbsp;</td>
                <td class="leftalign">Name&nbsp;</td>
                <td class="rightalign">Quantity&nbsp;</td>
                <td class="rightalign">Cost(Actual)&nbsp;</td>
                <td class="rightalign">Close Price&nbsp;</td>
                <td class="rightalign">MTM&nbsp;</td>
            </tr>


            @if (Report == "C")
            {
                if (GroupBy == "None")
                {

                    for (int i = 0; i < Model.Rows.Count; i++)
                    {
                        Qty = Qty + Convert.ToDecimal(Model.Rows[i]["Qty"]);
                        ActualCost = ActualCost + Convert.ToDecimal(Model.Rows[i]["ActualCost"]);
                        MarketValue = MarketValue + Convert.ToDecimal(Model.Rows[i]["MarketValue"]);
                        MTM = MTM + Convert.ToDecimal(Model.Rows[i]["MTM"]);
                        <tr>
                            <td class="leftalign">@Model.Rows[i]["Code"].ToString()&nbsp;</td>
                            <td class="leftalign">@Model.Rows[i]["Cname"].ToString()&nbsp;</td>
                            <td class="rightalign">@Model.Rows[i]["Qty"].ToString()&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["ActualCost"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MarketValue"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MTM"])&nbsp;</td>

                        </tr>

                    }

                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Sub Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }
                if (GroupBy == "Scrip")
                {
                    {
                        result = Model.AsEnumerable()
                                .GroupBy(row => row.Field
                                <string>("cm_name"))
                                 .Select(g => g.CopyToDataTable()).ToList();
                    }

                    foreach (DataTable item in result)
                    {
                        decimal SubQty = 0;
                        decimal SubActualCost = 0;
                        decimal SubMarketValue = 0;
                        decimal SubMTM = 0;
                        <tr>
                            <td colspan="6" class="leftalign">
                                <strong>
                                    @item.Rows[0]["HName"].ToString()
                                </strong>

                            </td>
                        </tr>
                        for (int i = 0; i < item.Rows.Count; i++)
                        {
                            Qty = Qty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            ActualCost = ActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            MarketValue = MarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            MTM = MTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            SubQty = SubQty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            SubActualCost = SubActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            SubMarketValue = SubMarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            SubMTM = SubMTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            <tr>
                                <td class="leftalign">@item.Rows[i]["Code"].ToString()&nbsp;</td>
                                <td class="leftalign">@item.Rows[i]["Cname"].ToString()&nbsp;</td>
                                <td class="rightalign">@item.Rows[i]["Qty"].ToString()&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["ActualCost"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MarketValue"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MTM"])&nbsp;</td>

                            </tr>

                        }
                        <tr style="background-color:#b0c4de; font-weight:bold;">
                            <td class="leftalign">Sub Total:</td>
                            <td class="leftalign"></td>
                            <td class="rightalign">@SubQty</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubActualCost)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMarketValue)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMTM)</td>



                        </tr>

                    }
                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>
                    </tr>
                }
            }

            @if (Report == "S")
            {
                if (GroupBy == "None")
                {
                    for (int i = 0; i < Model.Rows.Count; i++)
                    {
                        Qty = Qty + Convert.ToDecimal(Model.Rows[i]["Qty"]);
                        ActualCost = ActualCost + Convert.ToDecimal(Model.Rows[i]["ActualCost"]);
                        MarketValue = MarketValue + Convert.ToDecimal(Model.Rows[i]["MarketValue"]);
                        MTM = MTM + Convert.ToDecimal(Model.Rows[i]["MTM"]);
                        <tr>
                            <td class="leftalign">@Model.Rows[i]["Code"].ToString()&nbsp;</td>
                            <td class="leftalign">@Model.Rows[i]["Cname"].ToString()&nbsp;</td>
                            <td class="rightalign">@Model.Rows[i]["Qty"].ToString()&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["ActualCost"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MarketValue"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MTM"])&nbsp;</td>

                        </tr>

                    }

                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Sub Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }
                if (GroupBy == "Client")
                {
                    {
                        result = Model.AsEnumerable()
                                .GroupBy(row => row.Field
                                <string>("ss_name"))
                                 .Select(g => g.CopyToDataTable()).ToList();
                    }

                    foreach (DataTable item in result)
                    {
                        decimal SubQty = 0;
                        decimal SubActualCost = 0;
                        decimal SubMarketValue = 0;
                        decimal SubMTM = 0;
                        <tr>
                            <td colspan="6" class="leftalign">
                                <strong>
                                    @item.Rows[0]["HName"].ToString()
                                </strong>

                            </td>
                        </tr>
                        for (int i = 0; i < item.Rows.Count; i++)
                        {
                            Qty = Qty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            ActualCost = ActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            MarketValue = MarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            MTM = MTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            SubQty = SubQty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            SubActualCost = SubActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            SubMarketValue = SubMarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            SubMTM = SubMTM + Convert.ToDecimal(item.Rows[i]["MTM"]);

                            <tr>
                                <td class="leftalign">@item.Rows[i]["Code"].ToString()&nbsp;</td>
                                <td class="leftalign">@item.Rows[i]["Cname"].ToString()&nbsp;</td>
                                <td class="rightalign">@item.Rows[i]["Qty"].ToString()&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["ActualCost"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MarketValue"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MTM"])&nbsp;</td>

                            </tr>

                        }

                        <tr style="background-color:#b0c4de; font-weight:bold;">
                            <td class="leftalign">Sub Total:</td>
                            <td class="leftalign"></td>
                            <td class="rightalign">@SubQty</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubActualCost)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMarketValue)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMTM)</td>



                        </tr>
                    }
                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }


            }

        </table>

    <div id="GridNew" hidden="hidden">
        <style>
            table {
                font-family: arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
            }

            td, th {
                border: 1px #dddddd;
                text-align: left;
                padding: 4px;
            }

            .rightalign {
                text-align: right;
            }

            .leftalign {
                text-align: left;
            }

            .centeralign {
                text-align: center;
            }
        </style>
        <table id="tblClient" class="table">
            <tr class="GroupHeader">
                <td class="leftalign">Code&nbsp;</td>
                <td class="leftalign">Name&nbsp;</td>
                <td class="rightalign">Quantity&nbsp;</td>
                <td class="rightalign">Cost(Actual)&nbsp;</td>
                <td class="rightalign">Close Price&nbsp;</td>
                <td class="rightalign">MTM&nbsp;</td>
            </tr>


            @if (Report == "C")
            {
                if (GroupBy == "None")
                {

                    for (int i = 0; i < Model.Rows.Count; i++)
                    {
                        Qty = Qty + Convert.ToDecimal(Model.Rows[i]["Qty"]);
                        ActualCost = ActualCost + Convert.ToDecimal(Model.Rows[i]["ActualCost"]);
                        MarketValue = MarketValue + Convert.ToDecimal(Model.Rows[i]["MarketValue"]);
                        MTM = MTM + Convert.ToDecimal(Model.Rows[i]["MTM"]);
                        <tr>
                            <td class="leftalign">@Model.Rows[i]["Code"].ToString()&nbsp;</td>
                            <td class="leftalign">@Model.Rows[i]["Cname"].ToString()&nbsp;</td>
                            <td class="rightalign">@Model.Rows[i]["Qty"].ToString()&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["ActualCost"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MarketValue"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MTM"])&nbsp;</td>

                        </tr>

                    }

                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Sub Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }
                if (GroupBy == "Scrip")
                {
                    {
                        result = Model.AsEnumerable()
                                .GroupBy(row => row.Field
                                <string>("cm_name"))
                                 .Select(g => g.CopyToDataTable()).ToList();
                    }

                    foreach (DataTable item in result)
                    {
                        decimal SubQty = 0;
                        decimal SubActualCost = 0;
                        decimal SubMarketValue = 0;
                        decimal SubMTM = 0;
                        <tr>
                            <td colspan="6" class="leftalign">
                                <strong>
                                    @item.Rows[0]["HName"].ToString()
                                </strong>

                            </td>
                        </tr>
                        for (int i = 0; i < item.Rows.Count; i++)
                        {
                            Qty = Qty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            ActualCost = ActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            MarketValue = MarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            MTM = MTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            SubQty = SubQty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            SubActualCost = SubActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            SubMarketValue = SubMarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            SubMTM = SubMTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            <tr>
                                <td class="leftalign">@item.Rows[i]["Code"].ToString()&nbsp;</td>
                                <td class="leftalign">@item.Rows[i]["Cname"].ToString()&nbsp;</td>
                                <td class="rightalign">@item.Rows[i]["Qty"].ToString()&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["ActualCost"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MarketValue"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MTM"])&nbsp;</td>

                            </tr>

                        }
                        <tr style="background-color:#b0c4de; font-weight:bold;">
                            <td class="leftalign">Sub Total:</td>
                            <td class="leftalign"></td>
                            <td class="rightalign">@SubQty</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubActualCost)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMarketValue)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMTM)</td>



                        </tr>

                    }
                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>
                    </tr>
                }
            }

            @if (Report == "S")
            {
                if (GroupBy == "None")
                {
                    for (int i = 0; i < Model.Rows.Count; i++)
                    {
                        Qty = Qty + Convert.ToDecimal(Model.Rows[i]["Qty"]);
                        ActualCost = ActualCost + Convert.ToDecimal(Model.Rows[i]["ActualCost"]);
                        MarketValue = MarketValue + Convert.ToDecimal(Model.Rows[i]["MarketValue"]);
                        MTM = MTM + Convert.ToDecimal(Model.Rows[i]["MTM"]);
                        <tr>
                            <td class="leftalign">@Model.Rows[i]["Code"].ToString()&nbsp;</td>
                            <td class="leftalign">@Model.Rows[i]["Cname"].ToString()&nbsp;</td>
                            <td class="rightalign">@Model.Rows[i]["Qty"].ToString()&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["ActualCost"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MarketValue"])&nbsp;</td>
                            <td class="rightalign">@String.Format("{0:0.00}", Model.Rows[i]["MTM"])&nbsp;</td>

                        </tr>

                    }

                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Sub Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }
                if (GroupBy == "Client")
                {
                    {
                        result = Model.AsEnumerable()
                                .GroupBy(row => row.Field
                                <string>("ss_name"))
                                 .Select(g => g.CopyToDataTable()).ToList();
                    }

                    foreach (DataTable item in result)
                    {
                        decimal SubQty = 0;
                        decimal SubActualCost = 0;
                        decimal SubMarketValue = 0;
                        decimal SubMTM = 0;
                        <tr>
                            <td colspan="6" class="leftalign">
                                <strong>
                                    @item.Rows[0]["HName"].ToString()
                                </strong>

                            </td>
                        </tr>
                        for (int i = 0; i < item.Rows.Count; i++)
                        {
                            Qty = Qty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            ActualCost = ActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            MarketValue = MarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            MTM = MTM + Convert.ToDecimal(item.Rows[i]["MTM"]);
                            SubQty = SubQty + Convert.ToDecimal(item.Rows[i]["Qty"]);
                            SubActualCost = SubActualCost + Convert.ToDecimal(item.Rows[i]["ActualCost"]);
                            SubMarketValue = SubMarketValue + Convert.ToDecimal(item.Rows[i]["MarketValue"]);
                            SubMTM = SubMTM + Convert.ToDecimal(item.Rows[i]["MTM"]);

                            <tr>
                                <td class="leftalign">@item.Rows[i]["Code"].ToString()&nbsp;</td>
                                <td class="leftalign">@item.Rows[i]["Cname"].ToString()&nbsp;</td>
                                <td class="rightalign">@item.Rows[i]["Qty"].ToString()&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["ActualCost"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MarketValue"])&nbsp;</td>
                                <td class="rightalign">@String.Format("{0:0.00}", item.Rows[i]["MTM"])&nbsp;</td>

                            </tr>

                        }

                        <tr style="background-color:#b0c4de; font-weight:bold;">
                            <td class="leftalign">Sub Total:</td>
                            <td class="leftalign"></td>
                            <td class="rightalign">@SubQty</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubActualCost)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMarketValue)</td>
                            <td class="rightalign">@String.Format("{0:0.00}", SubMTM)</td>



                        </tr>
                    }
                    <tr style="background-color:#b0c4de; font-weight:bold;">
                        <td class="leftalign">Total:</td>
                        <td class="leftalign"></td>
                        <td class="rightalign">@Qty</td>
                        <td class="rightalign">@String.Format("{0:0.00}", ActualCost)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MarketValue)</td>
                        <td class="rightalign">@String.Format("{0:0.00}", MTM)</td>



                    </tr>
                }


            }

        </table>

    </div>

    <script src="~/Scripts/Export.js"></script>

