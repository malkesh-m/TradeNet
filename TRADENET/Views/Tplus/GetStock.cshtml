@model IEnumerable<TRADENET.Models.StockRMSModel>

@{
    Layout = null;
}
@if (Model == null || Model.Count() == 0)
{
    <div id="pnlPopup" class="alert alert-info">
        <strong>Info!</strong> NO RECORDS FOUND
    </div>
    return;
}
<style>
    td.details-control {
        cursor: pointer;
    }

    tr.shown td.details-control {
    }

    /*.GroupHeader {
        background: #b8d1f3;
    }*/
</style>
<div>
    <strong>
        Client Name : <label id="Name"></label>
        Client Code : <label id="Code"></label>
    </strong>
</div>
<script>
    $(document).ready(function () {

        $('#Name').text($('#dialog2').data('CName'));
        $('#Code').text($('#dialog2').data('Cid'));

    });
</script>
<table id="tblLedgerView" class="table table-hover table-striped">
    <thead>
        <tr class="GroupHeader">
            <th class="leftalign GroupHeader">Scrip Code</th>
            <th class="rightalign GroupHeader">Scrip Name</th>
            <th class="rightalign GroupHeader">Holding</th>
            <th class="rightalign GroupHeader">Actul Amount</th>
            <th class="rightalign GroupHeader">Amt After HairCut</th>
        </tr>
    </thead>
    <tbody>
        @{
            decimal GtotHolding = 0;
            decimal GtotActulAmount = 0;
            decimal GtotAmtAfterHairCut = 0;

            decimal AtotHolding = 0;
            decimal AtotActulAmount = 0;
            decimal AtotAmtAfterHairCut = 0;
        }
        @foreach (var d in Model)
        {
            if (d.Approved == "Y")
            {
                AtotHolding += d.Holding;
                AtotActulAmount += d.ActulAmount;
                AtotAmtAfterHairCut += d.AmtAfterHairCut;
            }
            else
            {
                GtotHolding += d.Holding;
                GtotActulAmount += d.ActulAmount;
                GtotAmtAfterHairCut += d.AmtAfterHairCut;
            }


            <tr>
                <td class="rightalign details-control"><a href="#">@d.ScripCode</a></td>
                <td class="rightalign">@d.ScripName</td>
                <td class="rightalign">@d.Holding</td>
                <td class="rightalign">@d.ActulAmount</td>
                <td class="rightalign">@d.AmtAfterHairCut</td>

            </tr>
        }
        <tr>
            <td class="rightalign GroupHeader"></td>
            <td class="rightalign GroupHeader"><strong>Grand Total:</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", GtotHolding)</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", Math.Abs(GtotActulAmount))</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", Math.Abs(GtotAmtAfterHairCut))</strong></td>
        </tr>
        <tr>
            <td class="rightalign GroupHeader"></td>
            <td class="rightalign GroupHeader"><strong>	Approved Total :</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", AtotHolding)</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", Math.Abs(AtotActulAmount))</strong></td>
            <td class="rightalign GroupHeader"><strong>@String.Format("{0:0.00}", Math.Abs(AtotAmtAfterHairCut))</strong></td>
        </tr>


    </tbody>
</table>
<script>
    function format(a, b) {
        var div = $('<div/>')
            .addClass('loading')
            .text('Loading...');


        $.ajax({
            type: "GET",
            url: '@Url.Action("GetStockbylink", "Tplus")',
            dataType: "html",
            data: { CCode: a, ScriptName: b },
            contentType: "application/html; charset=utf-8",
            beforeSend: function () {
                $('html, body').css("cursor", "wait");
            },
            success: function (data) {
                div
                    .html(data)
                    .removeClass('loading');
            },
            complete: function () {
                $('html, body').css("cursor", "auto");
            },
            failure: function (errMsg) {
                $('#divProcess1').hide();
                alert(errMsg);
            }
        });

        return div;
    }


    var table = $('#tblLedgerView').DataTable({
        "ordering": false,
        orderCellsTop: false,
        fixedHeader: false,
        bPaginate: false,
        bInfo: false,
        searching: false
    });
    $(document).ready(function () {
        $('#tblLedgerView tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            if (row.child.isShown()) {
                row.child.hide();

                //this.src = "~/resources/details_open.png";
                // This row is already open - close it

                //tr.removeClass('shown');
            }
            else {

                //row.child("dffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfdfdfdfdfdfdfdfdfdfdfdfdfdfdfdfdfdf").show();
                //this.src = "~/resources/details_close.png";
                // Open this row
                var client = $('#dialog2').data('Cid');
                var ScriptName = $(this).closest('tr').children('td:eq(0)').text()
                row.child(format(client, ScriptName)).show();
                //tr.addClass('shown');
            }
        });
    });
</script>


